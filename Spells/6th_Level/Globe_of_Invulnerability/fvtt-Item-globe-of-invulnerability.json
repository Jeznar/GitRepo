{
  "name": "Globe of Invulnerability",
  "type": "spell",
  "img": "systems/dnd5e/icons/spells/protect-magenta-3.jpg",
  "data": {
    "description": {
      "value": "<p>An immobile, faintly shimmering barrier springs into existence in a 10-foot radius around you and remains for the duration.</p>\n<p>Any spell of <strong>5th level or lower</strong> cast from outside the barrier<strong> can't affect creatures or objects within it</strong>, even if the spell is cast using a higher level spell slot. Such a spell can target creatures and objects within the barrier, but the spell has no effect on them. Similarly, the area within the barrier is excluded from the areas affected by such spells.</p>\n<p><strong>Higher Level.</strong>When you cast this spell using a spell slot of 7th level or higher, the barrier blocks spells of one level higher for each slot level above 6th.</p>\n<hr />\n<p><strong>FoundryVTT</strong>: Automation on this spell is strictly limited to running a VFX.Â  The GM will need to adjudicate effect on spells.</p>",
      "chat": "",
      "unidentified": ""
    },
    "source": "",
    "activation": {
      "type": "action",
      "cost": 1,
      "condition": ""
    },
    "duration": {
      "value": 1,
      "units": "minute"
    },
    "target": {
      "value": null,
      "width": null,
      "units": "",
      "type": "self"
    },
    "range": {
      "value": null,
      "long": null,
      "units": "self"
    },
    "uses": {
      "value": 0,
      "max": "0",
      "per": ""
    },
    "consume": {
      "type": "",
      "target": "",
      "amount": null
    },
    "ability": "",
    "actionType": "util",
    "attackBonus": 0,
    "chatFlavor": "",
    "critical": {
      "threshold": null,
      "damage": null
    },
    "damage": {
      "parts": [],
      "versatile": ""
    },
    "formula": "",
    "save": {
      "ability": "",
      "dc": null,
      "scaling": "spell"
    },
    "level": 6,
    "school": "abj",
    "components": {
      "value": "",
      "vocal": true,
      "somatic": true,
      "material": true,
      "ritual": false,
      "concentration": true
    },
    "materials": {
      "value": "A glass or crystal bead that shatters when the spell ends",
      "consumed": false,
      "cost": 0,
      "supply": 0
    },
    "preparation": {
      "mode": "prepared",
      "prepared": true
    },
    "scaling": {
      "mode": "level",
      "formula": ""
    }
  },
  "effects": [
    {
      "_id": "XbjpVEuvgp8QQSlJ",
      "changes": [
        {
          "key": "flags.gm-notes.notes",
          "mode": 0,
          "value": "GM to handle manually",
          "priority": "20"
        },
        {
          "key": "macro.itemMacro",
          "mode": 0,
          "value": "0",
          "priority": "20"
        }
      ],
      "disabled": false,
      "duration": {
        "startTime": null
      },
      "icon": "systems/dnd5e/icons/spells/protect-magenta-3.jpg",
      "label": "Globe of Invulnerability",
      "transfer": false,
      "flags": {
        "dae": {
          "stackable": "none",
          "macroRepeat": "none",
          "specialDuration": [],
          "transfer": false
        },
        "dnd5e-helpers": {
          "rest-effect": "Ignore"
        },
        "ActiveAuras": {
          "isAura": false,
          "aura": "None",
          "radius": null,
          "alignment": "",
          "type": "",
          "ignoreSelf": false,
          "height": false,
          "hidden": false,
          "hostile": false,
          "onlyOnce": false
        }
      },
      "tint": null,
      "selectedKey": [
        "flags.gm-notes.notes",
        "macro.itemMacro"
      ]
    }
  ],
  "sort": 0,
  "flags": {
    "core": {
      "sourceId": "Item.NGNjZjU5YjJmZTk5"
    },
    "midi-qol": {
      "onUseMacroName": "ItemMacro"
    },
    "itemacro": {
      "macro": {
        "data": {
          "_id": null,
          "name": "Globe of Invulnerability",
          "type": "script",
          "author": "ZjFlOWYxZjM5ZTZj",
          "img": "icons/svg/dice-target.svg",
          "scope": "global",
          "command": "const MACRONAME = \"Globe_of_Invulnerability.js\"\n/*****************************************************************************************\n * Run an appropriate VFX and a RuneVFX on the caster\n * \n * 04/11/22 0.1 Creation\n *****************************************************************************************/\nconst MACRO = MACRONAME.split(\".\")[0]     // Trim of the version number and extension\njez.log(`============== Starting === ${MACRONAME} =================`);\nfor (let i = 0; i < args.length; i++) jez.log(`  args[${i}]`, args[i]);\nconst LAST_ARG = args[args.length - 1];\nlet aActor;         // Acting actor, creature that invoked the macro\nif (LAST_ARG.tokenId) aActor = canvas.tokens.get(LAST_ARG.tokenId).actor;\nelse aActor = game.actors.get(LAST_ARG.actorId);\nlet aToken;         // Acting token, token for creature that invoked the macro\nif (LAST_ARG.tokenId) aToken = canvas.tokens.get(LAST_ARG.tokenId);\nelse aToken = game.actors.get(LAST_ARG.tokenId);\nlet aItem;          // Active Item information, item invoking this macro\nif (args[0]?.item) aItem = args[0]?.item;\nelse aItem = LAST_ARG.efData?.flags?.dae?.itemData;\nlet msg = \"\";\n//---------------------------------------------------------------------------------------\n// See https://gitlab.com/tposney/dae#lastarg for info on what is included in lastArg\n//\nconst lastArg = args[args.length - 1];\nif (lastArg.tokenId) aToken = canvas.tokens.get(lastArg.tokenId); else aToken = game.actors.get(lastArg.tokenId);\nif (args[0]?.item) aItem = args[0]?.item; else aItem = lastArg.efData?.flags?.dae?.itemData;\nconst EFFECT_NAME = aItem.name || MACRO || \"Minor_Globe_of_Invulnerability\";\nconst VFX_INTRO = \"jb2a.shield.02.intro.purple\"\nconst VFX_LOOP = \"jb2a.shield.02.loop.purple\";\nconst VFX_OUTRO = \"jb2a.shield.02.outro_explode.purple\";\nconst VFX_NAME = `${MACRO}-${aToken.name}`\nconst VFX_SCALE = 1.95\nconst VFX_OPACITY = 0.7\n//---------------------------------------------------------------------------------------\n// Do something Useful\n//\nif (args[0] === \"on\") doOn();          \t\t    // DAE Application\nif (args[0] === \"off\") doOff();        \t\t\t// DAE removal\nif (args[0]?.tag === \"OnUse\") await doOnUse();          // Midi ItemMacro On Use\n/***************************************************************************************\n *    END_OF_MAIN_MACRO_BODY\n *                                END_OF_MAIN_MACRO_BODY\n *                                                             END_OF_MAIN_MACRO_BODY\n ***************************************************************************************\n * Post results to the chat card\n ***************************************************************************************/\nfunction postResults(msg) {\n    jez.log(msg);\n    let chatMsg = game.messages.get(args[args.length - 1].itemCardId);\n    jez.addMessage(chatMsg, { color: jez.randomDarkColor(), fSize: 14, msg: msg, tag: \"saves\" });\n}\n/***************************************************************************************************\n * Perform the code that runs when this macro is invoked as an ItemMacro \"OnUse\"\n ***************************************************************************************************/\n async function doOnUse() {\n    jez.runRuneVFX(aToken, jez.getSpellSchool(aItem), \"purple\")\n    msg = `An immobile, faintly shimmering barrier springs into existence. Any spell of 5th level or \n    lower cast from outside the barrier can't affect creatures or objects within it...`\n    postResults(msg)\n    return (true);\n}\n/***************************************************************************************\n * Perform the steps that runs when this macro is executed by DAE to add to target\n ***************************************************************************************/\nasync function doOn() {\n\n    await jez.wait(250)\n    jez.log(\"---------------------------------\")\n    jez.log(\"aToken.center >>>>\", aToken.center)\n    jez.log(\"---------------------------------\")\n    await DAE.unsetFlag(aToken.actor, MACRONAME);\n    await DAE.setFlag(aToken.actor, MACRONAME, aToken.center);\n\n    new Sequence()\n    .effect()\n        .file(VFX_INTRO)\n        .opacity(VFX_OPACITY)\n        //.attachTo(aToken)\n        .atLocation(aToken)\n        .scale(VFX_SCALE)\n        .waitUntilFinished(-500) // Negative wait time (ms) clips the effect to avoid fadeout\n    .effect()\n        .file(VFX_LOOP)\n        //.attachTo(aToken)\n        .atLocation(aToken)\n        .opacity(VFX_OPACITY)\n        .scale(VFX_SCALE)\n        //.belowTokens()\n        .persist()\n        .name(VFX_NAME)             // Give the effect a uniqueish name\n        .fadeIn(500)                // Fade in for specified time in milliseconds\n        //.fadeOut(500)               // Fade out for specified time in milliseconds\n        .extraEndDuration(800)      // Time padding on exit to connect to Outro effect\n    .play()\n    return;\n}\n/***************************************************************************************\n * Perform the code that runs when this macro is removed by DAE, set Off\n ***************************************************************************************/\nasync function doOff() {\nSequencer.EffectManager.endEffects({ name: VFX_NAME });\n\nlet center = await DAE.getFlag(aToken.actor, MACRONAME, aToken.center);\nawait DAE.unsetFlag(aToken.actor, MACRONAME);\njez.log(\"---------------------------------\")\njez.log(\"center >>>>>>>>>>\", center)\njez.log(\"---------------------------------\")\n\n    new Sequence()\n    .effect()\n        .file(VFX_OUTRO)\n        .opacity(VFX_OPACITY)\n        .scale(VFX_SCALE)\n        //.attachTo(aToken)\n        .atLocation(center)\n    .play()\n    return;\n}",
          "folder": null,
          "sort": 0,
          "permission": {
            "default": 0
          },
          "flags": {}
        }
      }
    },
    "exportSource": {
      "world": "travels-in-barovia",
      "system": "dnd5e",
      "coreVersion": "0.8.9",
      "systemVersion": "1.5.3"
    }
  }
}