The following is a quote from [Crymic on Discord](https://discord.com/channels/562549978506199042/849048013468598272/968966845833019412), 4/27/21.

~~~
all token updates are now token.document.update()
creation now goes through: token.actor.createEmbeddedDocuments("Type", [array data]);
updates updateEmbeddedDocuments()
deletes deleteEmbeddedDocuments()
You can now pass multiple objects since it's an array. 
rolls new Roll("1d4").evaluate({async: true or false}); if you pick true, you'll need to await the roll. 
there's couple of changes to the canvas as well.
~~~

So, as in almost everything Crymic posts, there is a lot to unpack in those lines.  I need a deeper understanding, the following is my attempt at understanding each element.

## Token updates now token.document.update()

### token.update
My code has more than a few token updates.  Create_Specter.js contains an example:

~~~javascript
tToken.update({ "hidden": true });
~~~

I think the above needs to be updated to read as follows:

~~~javascript
tToken.document.update({ "hidden": true });
~~~

### actor.update
I fiddled with what looks to be a similar call in *Healing_Light.js* that read as:

~~~javascript
await aToken.actor.update(resUpdate);
~~~ 

The above does not generate a warning, I'm presuming it is still ok. 

### chatmsg.update 
This type of call is not a token, but its similarity makes me wonder if it might be affected.  The following line is pretty common in my scripts for updating a chat card:

~~~javascript
await chatmsg.update({ content: content });
~~~

I will need to test for issues related and perhaps initiate a wholesale update.

### effect.update

Do the calls to effect.update need to be updated?  There are lots of uses similar to the following:

~~~javascript
const result = await effect.update({ 'flags.dae.specialDuration': effect.data.flags.dae.specialDuration,
                                         'origin': LAST_ARG.itemUuid });                                    
~~~

### tokens.updateMany

I have a few instances of using this call, which read similarly to the following:

~~~javascript
canvas.tokens.updateMany(updates);
~~~

That seems like another potential area needing its calls changed.

## Creation: createEmbeddedDocuments(...)

The 9.x format for this call looks like the following:

~~~javascript
token.actor.createEmbeddedDocuments("Type", [array data])
~~~

Crymic pointed out: *You can now pass multiple objects since it's an array.* I'll need to fiddle with this to get benefit, I think.

Scanning my code, it seems I have been mostly using the *new* style and should generally be ok on this one.  

Two exceptions, the first being *Tile.create(...)* calls.  This snippet is from *Cloudkill.js*

~~~javascript
let newTile = await Tile.create({
        x: templateCenter.x,
        y: templateCenter.y,
        img: "modules/jb2a_patreon/Library/1st_Level/Fog_Cloud/FogCloud_03_Regular_Green02_800x800.webm",
        width: GRID_SIZE * 8,   // 20 foot across
        height: GRID_SIZE * 8   // 20 foot tall 
    });
~~~

The second being *ChatMessage.create(...)* calls, quite a few of them, but the most often used from within *jez-lib.js*

~~~javascript
await ChatMessage.create({
          speaker: speaker ? ChatMessage.getSpeaker(speaker) : null,
          type: CONST.CHAT_MESSAGE_TYPES.OTHER,
          content: chatCard
      });
~~~

## Update: updateEmbeddedDocuments(...)

I have a fairly large number of calls that look like (this one from Etherealness.js)

~~~javascript
await aToken.update({ "hidden": false });
~~~


## Delete deleteEmbeddedDocuments(...)

Lots of calls to *.delete(...)* that may be affected here.  One example from *Toggle_Flanking_1.0.s*

~~~javascript
await existingEffect.delete();
~~~

## Roll now requires async true/false
Crymic pointed out, rolls needs to specify async:false or be awaited. 

~~~javascript
new Roll("1d4").evaluate({async: true or false}); 
~~~

Lines like the following from *cloudkill.js* are going to fail with damageRoll getting an unfulfilled promise. 

~~~javascript
let damageRoll = new Roll("5d8[poison]").roll();
~~~

## Couple of changes to the canvas

I have no idea what these are, so I suppose I will bump into them. 

## Sequencer Updates

In testing I noticed the following warning: 

~~~javascript
Sequencer | Window | reachTowards - This method has been deprecated, please use .stretchTo() instead
~~~

This was generated by *Healing_Light.js* which contained the following line:

~~~javascript
.reachTowards(token1)
~~~

Changing it to this, resolved the warning:

~~~javascript
.stretchTo(token1) // Replacement for .reachTowards
~~~

My GitRepo contains the following problem children for this case:

![reachTowards().png](Upgrading_8.9_to_9.x/reachTowards().png)
 
The above all need fixed.  